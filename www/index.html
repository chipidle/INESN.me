<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <!-- <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *" /> -->
        <meta http-equiv="Content-Security-Policy" content="default-src *; style-src * 'self' 'unsafe-inline' 'unsafe-eval'; script-src * 'self' 'unsafe-inline' 'unsafe-eval';">
        <title>â˜… INESN.me LITE</title>
        <script src="cordova.js"></script>
        <!-- <script type="text/javascript" src="https://github.com/cubiq/iscroll/raw/master/build/iscroll.js"></script> -->
        <style type="text/css">
            html, body {height:100%;margin:0;}
            .spinner {-webkit-animation: spin 6s infinite linear;}
            @-webkit-keyframes spin {
                0%  {-webkit-transform: rotate(0deg);}
                100% {-webkit-transform: rotate(360deg);}
            }
        </style>
        <script type="text/javascript">
            document.addEventListener('deviceready',function(){
                navigator.splashscreen.hide();
                if (!navigator.network || !navigator.network.connection || !Connection) {
                     console.log(">>> ERROR, it seems cordova network connection plugin has not been loaded.");
                     return;
                  }

                  var iframe = document.getElementById('cHiPiDlE');
                  var loading = document.getElementById('loading');
                  var offline = document.getElementById('offline');

                  function sendMessage(msg) {
                    alert(msg);
                    iframe.contentWindow.postMessage("cordova-" + msg, "*");
                  }

                  function check() {
                    var sts = navigator.network.connection.type == Connection.NONE ? 'offline' : 'online';
                    sendMessage(sts);
                  }
                  function showIframe(ev) {
                      iframe.style.width = iframe.style.height = "100%";
                      sendMessage('resume');
                      loading.parentNode.removeChild(loading);
                  }
                  // Listen for offline/online events
                  document.addEventListener('offline', check, false);
                  document.addEventListener('online', check, false);
                  document.addEventListener('resume', function(){sendMessage('resume')}, false);
                  document.addEventListener('pause', function(){sendMessage('pause')}, false);
                  // check the connection periodically
                  setInterval(check, 30000);

                  // when vaadin app is loaded, it sends to the parent window a ready message
                  window.addEventListener('message', showIframe, false);

                  // Ignore back button in android
                  document.addEventListener('backbutton', function() { sendMessage('back'); }, false);
            });
            check = function(){
                $(function(){
                    var f = $("#cHiPiDlE"),
                        w,h,r = window.devicePixelRatio;
                    alert("Ratio: "+r+"\nWindow: "+(window.innerWidth)+"x"+(window.innerHeight)+"\nIframe: "+(w=f.width())+"x"+(h=f.height())+"\nPhysical: "+(window.screen.width*r)+"x"+(window.screen.height*r));
                    // f.width(w/r).height(h/r);
                    myScroll = new IScroll('#wrap');
                });
            };
              function failedIframe() {
                document.getElementById('offline').style.display = 'none';
                document.getElementById('spinner').className = '';
                document.getElementById('retry').style.display = 'block';
              }
              function retryIframe() {
                document.getElementById('offline').style.display = 'block';
                document.getElementById('spinner').className = 'spinner';
                document.getElementById('retry').style.display = 'none';
                setTimeout(failedIframe, 20000);
                document.getElementById('cHiPiDlE').src = document.getElementById('cHiPiDlE').src;
              }
        </script>
        <!-- <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script> -->
    </head>
    <body>
        <!-- A div to show in the meanwhile the app is loaded -->
        <div id='loading' style='font-size: 120%; font-weight: bold; font-family: helvetica; width: 100%; height: 100%; position: absolute; text-align: center;'>
          <div id='spinner' class='spinner'><img src="icon.png"></div>
          <div id='offline' style='display: block;  padding: 15px;'>Downloading application files,<br/>Please be patient...</div>
          <div id="retry" style="display: none;">
            <p>Failed to contact the server.</p>
            <p>
              Please ensure you have a stable Internet connection, and then
              <a href="javascript:void(0)" onclick="retryIframe();">touch here</a> to retry.
            </p>
          </div>
        </div>
        <!-- Load the app in an iframe so as we can pass messages, instead of using redirect -->
        <iframe id=cHiPiDlE src="http://inesn.me?appKey=cHiPiDlE" style="width: 0; height: 0; position: absolute; border: 0;top:0;left:0;" onload="showIframe();"></iframe>
    </body>
</html>